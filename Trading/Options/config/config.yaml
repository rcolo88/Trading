# Options Backtesting Configuration

# Target underlying asset
underlying:
  symbol: SPY
  name: "SPDR S&P 500 ETF Trust"

# Backtesting period
backtest:
  start_date: "2025-04-03"  # Matches synthetic data start date
  end_date: "2025-8-30"    # Matches synthetic data end date
  initial_capital: 10000

# Data source configuration
data_source:
  primary: "quantconnect"  # Options: quantconnect, yahoo, polygon, schwab
  backup: "yahoo"  # For underlying price data
  cache_enabled: true
  cache_dir: "data/processed"

# Transaction costs
costs:
  commission_per_contract: 0.65  # Per contract per side
  slippage_percent: 0.02  # 1% slippage estimate
  bid_ask_spread_percent: 0.02  # 2% bid-ask spread estimate

# Strategy parameters
strategies:
  bull_put_spread:          # Credit spread - neutral to bullish
    enabled: true
    entry:
      dte_min: 30           # Days to expiration
      dte_max: 45
      short_delta: 0.30     # Sell put with ~30 delta
      long_delta: 0.10      # Buy put with ~20 delta
      vix_min: 15           # Don't enter if VIX < 15 (need decent premium)
      vix_max: 50           # Don't enter if VIX > 50 (too risky)
    exit:
      profit_target: 0.50   # Close at 50% of max profit
      stop_loss: 0.50       # Stop at 50% of max loss
      dte_min: 21           # Close if DTE drops below 21

  bull_call_spread:         # Debit spread - moderately bullish
    enabled: true
    entry:
      dte_min: 30
      dte_max: 60
      long_delta: 0.60      # Buy call with ~60 delta
      short_delta: 0.40     # Sell call with ~40 delta
      vix_min: 10           # Can enter in lower volatility (cheaper debit)
      vix_max: 40           # Don't enter if VIX > 40 (too expensive)
    exit:
      profit_target: 0.75   # Target 75% of max profit
      stop_loss: 0.50       # Stop at 50% of max loss
      dte_min: 14

  call_calendar:            # Time spread - neutral to slightly bullish
    enabled: true
    entry:
      near_dte: 30           # Sell 30 DTE call
      far_dte: 60            # Buy 60 DTE call
      dte_tolerance: 5       # +/- 5 days tolerance
      strike_selection: "atm"  # Options: atm, delta, moneyness
      target_delta: 0.50     # Used if strike_selection = "delta"
      moneyness: 0.0         # Used if strike_selection = "moneyness" (0.0 = ATM)
      min_debit: 0.5         # Minimum debit to enter (optional)
      max_debit: 5.0         # Maximum debit to enter (optional)
      vix_min: 12           # Prefer low IV environment
      vix_max: 30           # Don't enter if VIX too high (defeats calendar purpose)
    exit:
      profit_target: 0.25    # Close at 25% profit
      stop_loss: -0.50       # Stop at 50% loss
      dte_exit: 7            # Exit when near-term has 7 DTE left
      max_underlying_move: 0.10  # Exit if underlying moves >10% from strike

# Position sizing
position_sizing:
  method: "fixed_risk"  # Options: fixed_risk, kelly 
  risk_per_trade_percent: 2.0  # Used when method = "fixed_risk"
  max_positions: 5  # Maximum concurrent positions
  max_positions_per_strategy: 3

  # Kelly Criterion percentages (manually updated from Kelly_Criteria notebook)
  # Workflow:
  #   1. Run backtest → 2. Calculate Kelly in notebook → 3. Update values below
  # Important: Use Half Kelly (multiply by 0.5) or Quarter Kelly (multiply by 0.25)
  kelly_pct:
    bull_put_spread: 0.06    # Example: 6% (Half Kelly of 12%)
    bull_call_spread: 0.04   # Example: 4% (Half Kelly of 8%)
    call_calendar: 0.05      # Example: 5% (Half Kelly of 10%)

# Market filters (global fallback - each strategy has its own VIX criteria in entry section)
market_filters:
  vix_max: 40  # Global fallback: Don't enter if VIX > 40
  vix_min: 12  # Global fallback: Don't enter if VIX < 12
  iv_rank_min: 30  # Prefer IV rank > 30 (not yet implemented)

# Analysis and reporting
analysis:
  metrics:
    - "total_pnl"
    - "annualized_return"
    - "win_rate"
    - "profit_factor"
    - "max_drawdown"
    - "sharpe_ratio"
    - "calmar_ratio"
    - "average_win"
    - "average_loss"
    - "trade_count"

  visualization:
    plot_equity_curve: true
    plot_drawdown: true
    plot_monthly_returns: true
    plot_greeks_exposure: true

# Logging
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  file: "logs/backtest.log"
  console: true
